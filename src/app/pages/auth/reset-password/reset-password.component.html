<!-- Layout de Redefinir Senha -->
<div class="auth-layout">
  
  <!-- Container Principal -->
  <div class="auth-container">
    <div class="container">
      <div class="grid justify-content-center">
        <div class="col-12 md:col-8 lg:col-6 xl:col-4">
          
          <!-- Card de Redefinição -->
          <p-card class="auth-card">
            
            <!-- Header -->
            <ng-template pTemplate="header">
              <div class="auth-header text-center">
                <i class="pi pi-lock text-6xl text-primary mb-3"></i>
                <h1 class="text-3xl font-bold text-900 m-0 mb-2">Nova Senha</h1>
                <p class="text-600 m-0">
                  {{ senhaRedefinida ? 'Senha redefinida com sucesso!' : 'Digite sua nova senha' }}
                </p>
              </div>
            </ng-template>

            <!-- Token Inválido -->
            <div *ngIf="!tokenValido" class="text-center">
              <div class="error-icon mb-4">
                <i class="pi pi-times-circle text-6xl text-red-500"></i>
              </div>
              <h3 class="text-xl font-semibold text-900 mb-3">Link Inválido</h3>
              <p class="text-600 mb-4">
                O link de recuperação é inválido ou expirou. 
                Solicite um novo link de recuperação.
              </p>
              <p-button 
                label="Solicitar Novo Link"
                icon="pi pi-refresh"
                (onClick)="voltarParaRecuperacao()">
              </p-button>
            </div>

            <!-- Formulário -->
            <div *ngIf="tokenValido && !senhaRedefinida">
              
              <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
                
                <!-- Nova Senha -->
                <div class="field mb-4">
                  <label for="password" class="block text-900 font-medium mb-2">
                    Nova Senha <span class="text-red-500">*</span>
                  </label>
                  <span class="p-input-icon-left w-full">
                    <i class="pi pi-lock"></i>
                    <input 
                      id="password"
                      type="password" 
                      pInputText 
                      formControlName="password"
                      placeholder="Digite sua nova senha"
                      class="w-full"
                      [class.ng-invalid]="passwordInvalid"
                      [class.ng-dirty]="password?.touched">
                  </span>
                  
                  <!-- Mensagens de Erro -->
                  <small *ngIf="passwordInvalid" class="p-error block mt-1">
                    <span *ngIf="password?.errors?.['required']">Senha é obrigatória</span>
                    <span *ngIf="password?.errors?.['minlength']">Senha deve ter pelo menos 6 caracteres</span>
                  </small>
                </div>

                <!-- Confirmar Senha -->
                <div class="field mb-4">
                  <label for="confirmPassword" class="block text-900 font-medium mb-2">
                    Confirmar Senha <span class="text-red-500">*</span>
                  </label>
                  <span class="p-input-icon-left w-full">
                    <i class="pi pi-lock"></i>
                    <input 
                      id="confirmPassword"
                      type="password" 
                      pInputText 
                      formControlName="confirmPassword"
                      placeholder="Confirme sua nova senha"
                      class="w-full"
                      [class.ng-invalid]="confirmPasswordInvalid || passwordMismatch"
                      [class.ng-dirty]="confirmPassword?.touched">
                  </span>
                  
                  <!-- Mensagens de Erro -->
                  <small *ngIf="confirmPasswordInvalid || passwordMismatch" class="p-error block mt-1">
                    <span *ngIf="confirmPassword?.errors?.['required']">Confirmação é obrigatória</span>
                    <span *ngIf="passwordMismatch">Senhas não coincidem</span>
                  </small>
                </div>

                <!-- Dicas de Segurança -->
                <div class="security-tips mb-4">
                  <h5 class="text-900 font-semibold mb-2">Dicas para uma senha segura:</h5>
                  <ul class="text-600 text-sm">
                    <li>Pelo menos 6 caracteres</li>
                    <li>Combine letras, números e símbolos</li>
                    <li>Evite informações pessoais</li>
                    <li>Use uma senha única para esta conta</li>
                  </ul>
                </div>

                <!-- Botão Redefinir -->
                <p-button 
                  type="submit"
                  label="Redefinir Senha"
                  icon="pi pi-check"
                  styleClass="w-full mb-3"
                  [loading]="loading"
                  [disabled]="resetPasswordForm.invalid">
                </p-button>

              </form>

              <!-- Link para Login -->
              <div class="text-center">
                <p class="text-600 mb-2">Lembrou da senha?</p>
                <p-button 
                  label="Voltar ao Login"
                  icon="pi pi-arrow-left"
                  styleClass="p-button-text"
                  (onClick)="irParaLogin()">
                </p-button>
              </div>

            </div>

            <!-- Confirmação de Sucesso -->
            <div *ngIf="senhaRedefinida" class="text-center">
              
              <!-- Ícone de Sucesso -->
              <div class="success-icon mb-4">
                <i class="pi pi-check-circle text-6xl text-green-500"></i>
              </div>

              <!-- Mensagem -->
              <h3 class="text-xl font-semibold text-900 mb-3">Senha Redefinida!</h3>
              <p class="text-600 mb-4 line-height-3">
                Sua senha foi redefinida com sucesso. 
                Agora você pode fazer login com sua nova senha.
              </p>

              <!-- Botão para Login -->
              <p-button 
                label="Fazer Login"
                icon="pi pi-sign-in"
                (onClick)="irParaLogin()">
              </p-button>

            </div>

          </p-card>

        </div>
      </div>
    </div>
  </div>

</div>

<!-- Toast para notificações -->
<p-toast position="top-right"></p-toast>